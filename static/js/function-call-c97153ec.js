import{d as Pe,u as me,L as Ee,P as Re,m as Xe,b as De}from"./index-296cc66d.js";import{l as Q,D as E,q as H,O as j,m as J,j as A,r as re,G as _e,Q as I,T as R,ae as xe,af as Ce,ax as Le,k as ue,ah as Me,ai as Ze,a6 as Ae,a7 as Ie,V as Te,a as w,ac as he,U as K,ar as ae,C as ne,ay as Z,w as ge,P as Be,av as He,v as de,E as We,a0 as ze,z as se,as as Ne,az as je,Y as ce,I as $e,ag as oe,a2 as Fe,ad as Oe,aA as we,aB as Ue,aC as qe,s as ye,at as Ve,aD as Ge,ak as Ke,x as Qe}from"./index-fc2dbbe8.js";const[Ye,ie]=Q("swipe"),Je={loop:E,width:H,height:H,vertical:Boolean,autoplay:j(0),duration:j(500),touchable:E,lazyRender:Boolean,initialSwipe:j(0),indicatorColor:String,showIndicators:E,stopPropagation:E},ke=Symbol(Ye);var pe=J({name:Ye,props:Je,emits:["change","dragStart","dragEnd"],setup(e,{emit:d,slots:f}){const t=A(),n=A(),a=re({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let P=!1;const h=Pe(),{children:y,linkChildren:m}=_e(ke),s=I(()=>y.length),r=I(()=>a[e.vertical?"height":"width"]),g=I(()=>e.vertical?h.deltaY.value:h.deltaX.value),x=I(()=>a.rect?(e.vertical?a.rect.height:a.rect.width)-r.value*s.value:0),$=I(()=>r.value?Math.ceil(Math.abs(x.value)/r.value):s.value),L=I(()=>s.value*r.value),l=I(()=>(a.active+s.value)%s.value),T=I(()=>{const i=e.vertical?"vertical":"horizontal";return h.direction.value===i}),u=I(()=>{const i={transitionDuration:`${a.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+a.offset.toFixed(2)}px)`};if(r.value){const S=e.vertical?"height":"width",b=e.vertical?"width":"height";i[S]=`${L.value}px`,i[b]=e[b]?`${e[b]}px`:""}return i}),X=i=>{const{active:S}=a;return i?e.loop?Z(S+i,-1,s.value):Z(S+i,0,$.value):S},D=(i,S=0)=>{let b=i*r.value;e.loop||(b=Math.min(b,-x.value));let k=S-b;return e.loop||(k=Z(k,x.value,0)),k},Y=({pace:i=0,offset:S=0,emitChange:b})=>{if(s.value<=1)return;const{active:k}=a,O=X(i),G=D(O,S);if(e.loop){if(y[0]&&G!==x.value){const ve=G<x.value;y[0].setOffset(ve?L.value:0)}if(y[s.value-1]&&G!==0){const ve=G>0;y[s.value-1].setOffset(ve?-L.value:0)}}a.active=O,a.offset=G,b&&O!==k&&d("change",l.value)},M=()=>{a.swiping=!0,a.active<=-1?Y({pace:s.value}):a.active>=s.value&&Y({pace:-s.value})},p=()=>{M(),h.reset(),ae(()=>{a.swiping=!1,Y({pace:-1,emitChange:!0})})},F=()=>{M(),h.reset(),ae(()=>{a.swiping=!1,Y({pace:1,emitChange:!0})})};let ee;const W=()=>clearTimeout(ee),N=()=>{W(),+e.autoplay>0&&s.value>1&&(ee=setTimeout(()=>{F(),N()},+e.autoplay))},B=(i=+e.initialSwipe)=>{if(!t.value)return;const S=()=>{var b,k;if(!he(t)){const O={width:t.value.offsetWidth,height:t.value.offsetHeight};a.rect=O,a.width=+((b=e.width)!=null?b:O.width),a.height=+((k=e.height)!=null?k:O.height)}s.value&&(i=Math.min(s.value-1,i),i===-1&&(i=s.value-1)),a.active=i,a.swiping=!0,a.offset=D(i),y.forEach(O=>{O.setOffset(0)}),N()};he(t)?K().then(S):S()},V=()=>B(a.active);let te;const o=i=>{!e.touchable||i.touches.length>1||(h.start(i),P=!1,te=Date.now(),W(),M())},c=i=>{e.touchable&&a.swiping&&(h.move(i),T.value&&(!e.loop&&(a.active===0&&g.value>0||a.active===s.value-1&&g.value<0)||(ne(i,e.stopPropagation),Y({offset:g.value}),P||(d("dragStart",{index:l.value}),P=!0))))},v=()=>{if(!e.touchable||!a.swiping)return;const i=Date.now()-te,S=g.value/i;if((Math.abs(S)>.25||Math.abs(g.value)>r.value/2)&&T.value){const k=e.vertical?h.offsetY.value:h.offsetX.value;let O=0;e.loop?O=k>0?g.value>0?-1:1:0:O=-Math[g.value>0?"ceil":"floor"](g.value/r.value),Y({pace:O,emitChange:!0})}else g.value&&Y({pace:0});P=!1,a.swiping=!1,d("dragEnd",{index:l.value}),N()},C=(i,S={})=>{M(),h.reset(),ae(()=>{let b;e.loop&&i===s.value?b=a.active===0?0:i:b=i%s.value,S.immediate?ae(()=>{a.swiping=!1}):a.swiping=!1,Y({pace:b-a.active,emitChange:!0})})},z=(i,S)=>{const b=S===l.value,k=b?{backgroundColor:e.indicatorColor}:void 0;return w("i",{style:k,class:ie("indicator",{active:b})},null)},_=()=>{if(f.indicator)return f.indicator({active:l.value,total:s.value});if(e.showIndicators&&s.value>1)return w("div",{class:ie("indicators",{vertical:e.vertical})},[Array(s.value).fill("").map(z)])};return me({prev:p,next:F,state:a,resize:V,swipeTo:C}),m({size:r,props:e,count:s,activeIndicator:l}),R(()=>e.initialSwipe,i=>B(+i)),R(s,()=>B(a.active)),R(()=>e.autoplay,N),R([xe,Ce,()=>e.width,()=>e.height],V),R(Le(),i=>{i==="visible"?N():W()}),ue(B),Me(()=>B(a.active)),Ze(()=>B(a.active)),Ae(W),Ie(W),Te("touchmove",c,{target:n}),()=>{var i;return w("div",{ref:t,class:ie()},[w("div",{ref:n,style:u.value,class:ie("track",{vertical:e.vertical}),onTouchstartPassive:o,onTouchend:v,onTouchcancel:v},[(i=f.default)==null?void 0:i.call(f)]),_()])}}});const et=ge(pe),[tt,at]=Q("swipe-item");var ot=J({name:tt,setup(e,{slots:d}){let f;const t=re({offset:0,inited:!1,mounted:!1}),{parent:n,index:a}=Be(ke);if(!n)return;const P=I(()=>{const m={},{vertical:s}=n.props;return n.size.value&&(m[s?"height":"width"]=`${n.size.value}px`),t.offset&&(m.transform=`translate${s?"Y":"X"}(${t.offset}px)`),m}),h=I(()=>{const{loop:m,lazyRender:s}=n.props;if(!s||f)return!0;if(!t.mounted)return!1;const r=n.activeIndicator.value,g=n.count.value-1,x=r===0&&m?g:r-1,$=r===g&&m?0:r+1;return f=a.value===r||a.value===x||a.value===$,f}),y=m=>{t.offset=m};return ue(()=>{K(()=>{t.mounted=!0})}),me({setOffset:y}),()=>{var m;return w("div",{class:at(),style:P.value},[h.value?(m=d.default)==null?void 0:m.call(d):null])}}});const it=ge(ot),[nt,U]=Q("image"),lt={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:H,height:H,radius:H,lazyLoad:Boolean,iconSize:H,showError:E,errorIcon:se("photo-fail"),iconPrefix:String,showLoading:E,loadingIcon:se("photo")};var st=J({name:nt,props:lt,emits:["load","error"],setup(e,{emit:d,slots:f}){const t=A(!1),n=A(!0),a=A(),{$Lazyload:P}=He().proxy,h=I(()=>{const l={width:de(e.width),height:de(e.height)};return We(e.radius)&&(l.overflow="hidden",l.borderRadius=de(e.radius)),l});R(()=>e.src,()=>{t.value=!1,n.value=!0});const y=l=>{n.value&&(n.value=!1,d("load",l))},m=()=>{const l=new Event("load");Object.defineProperty(l,"target",{value:a.value,enumerable:!0}),y(l)},s=l=>{t.value=!0,n.value=!1,d("error",l)},r=(l,T,u)=>u?u():w($e,{name:l,size:e.iconSize,class:T,classPrefix:e.iconPrefix},null),g=()=>{if(n.value&&e.showLoading)return w("div",{class:U("loading")},[r(e.loadingIcon,U("loading-icon"),f.loading)]);if(t.value&&e.showError)return w("div",{class:U("error")},[r(e.errorIcon,U("error-icon"),f.error)])},x=()=>{if(t.value||!e.src)return;const l={alt:e.alt,class:U("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?Ne(w("img",ce({ref:a},l),null),[[je("lazy"),e.src]]):w("img",ce({ref:a,src:e.src,onLoad:y,onError:s},l),null)},$=({el:l})=>{const T=()=>{l===a.value&&n.value&&m()};a.value?T():K(T)},L=({el:l})=>{l===a.value&&!t.value&&s()};return P&&ze&&(P.$on("loaded",$),P.$on("error",L),Ie(()=>{P.$off("loaded",$),P.$off("error",L)})),ue(()=>{K(()=>{var l;(l=a.value)!=null&&l.complete&&!e.lazyLoad&&m()})}),()=>{var l;return w("div",{class:U({round:e.round,block:e.block}),style:h.value},[x(),g(),(l=f.default)==null?void 0:l.call(f)])}}});const ct=ge(st),Se=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),rt=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),fe=Q("image-preview")[1],be=2.6;var ut=J({props:{src:String,show:Boolean,active:Number,minZoom:oe(H),maxZoom:oe(H),rootWidth:oe(Number),rootHeight:oe(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:d,slots:f}){const t=re({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),n=Pe(),a=A(),P=A(),h=A(!1),y=A(!1);let m=0;const s=I(()=>{const{scale:o,moveX:c,moveY:v,moving:C,zooming:z,initializing:_}=t,i={transitionDuration:z||C||_?"0s":".3s"};return(o!==1||y.value)&&(i.transform=`matrix(${o}, 0, 0, ${o}, ${c}, ${v})`),i}),r=I(()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:c}=e,v=h.value?c/t.imageRatio:o;return Math.max(0,(t.scale*v-o)/2)}return 0}),g=I(()=>{if(t.imageRatio){const{rootWidth:o,rootHeight:c}=e,v=h.value?c:o*t.imageRatio;return Math.max(0,(t.scale*v-c)/2)}return 0}),x=(o,c)=>{var v;if(o=Z(o,+e.minZoom,+e.maxZoom+1),o!==t.scale){const C=o/t.scale;if(t.scale=o,c){const z=Oe((v=a.value)==null?void 0:v.$el),_={x:z.width*.5,y:z.height*.5},i=t.moveX-(c.x-z.left-_.x)*(C-1),S=t.moveY-(c.y-z.top-_.y)*(C-1);t.moveX=Z(i,-r.value,r.value),t.moveY=Z(S,-g.value,g.value)}else t.moveX=0,t.moveY=y.value?m:0;d("scale",{scale:o,index:e.active})}},$=()=>{x(1)},L=()=>{const o=t.scale>1?1:2;x(o,o===2||y.value?{x:n.startX.value,y:n.startY.value}:void 0)};let l,T,u,X,D,Y,M,p,F=!1;const ee=o=>{const{touches:c}=o;if(l=c.length,l===2&&e.disableZoom)return;const{offsetX:v}=n;n.start(o),T=t.moveX,u=t.moveY,p=Date.now(),F=!1,t.moving=l===1&&(t.scale!==1||y.value),t.zooming=l===2&&!v.value,t.zooming&&(X=t.scale,D=Se(c))},W=o=>{const{touches:c}=o;if(n.move(o),t.moving){const{deltaX:v,deltaY:C}=n,z=v.value+T,_=C.value+u;if((z>r.value||z<-r.value)&&!F&&n.isHorizontal()){t.moving=!1;return}F=!0,ne(o,!0),t.moveX=Z(z,-r.value,r.value),t.moveY=Z(_,-g.value,g.value)}if(t.zooming&&(ne(o,!0),c.length===2)){const v=Se(c),C=X*v/D;Y=rt(c),x(C,Y)}},N=o=>{var c;if(l>1)return;const{offsetX:v,offsetY:C}=n,z=Date.now()-p,_=250;if(v.value<we&&C.value<we)if(z<_)if(e.doubleScale)if(M)clearTimeout(M),M=null,L();else{if(!e.closeOnClickOverlay&&o.target===((c=P.value)==null?void 0:c.$el))return;M=setTimeout(()=>{d("close"),M=null},_)}else d("close");else z>Ue&&d("longPress")},B=o=>{let c=!1;if((t.moving||t.zooming)&&(c=!0,t.moving&&T===t.moveX&&u===t.moveY&&(c=!1),!o.touches.length)){t.zooming&&(t.moveX=Z(t.moveX,-r.value,r.value),t.moveY=Z(t.moveY,-g.value,g.value),t.zooming=!1),t.moving=!1,T=0,u=0,X=1,t.scale<1&&$();const v=+e.maxZoom;t.scale>v&&x(v,Y)}ne(o,c),N(o),n.reset()},V=()=>{const{rootWidth:o,rootHeight:c}=e,v=c/o,{imageRatio:C}=t;h.value=t.imageRatio>v&&C<be,y.value=t.imageRatio>v&&C>=be,y.value&&(m=(C*o-c)/2,t.moveY=m,t.initializing=!0,Fe(()=>{t.initializing=!1})),$()},te=o=>{const{naturalWidth:c,naturalHeight:v}=o.target;t.imageRatio=v/c,V()};return R(()=>e.active,$),R(()=>e.show,o=>{o||$()}),R(()=>[e.rootWidth,e.rootHeight],V),Te("touchmove",W,{target:I(()=>{var o;return(o=P.value)==null?void 0:o.$el})}),()=>{const o={loading:()=>w(Ee,{type:"spinner"},null)};return w(it,{ref:P,class:fe("swipe-item"),onTouchstartPassive:ee,onTouchend:B,onTouchcancel:B},{default:()=>[f.image?w("div",{class:fe("image-wrap")},[f.image({src:e.src})]):w(ct,{ref:a,src:e.src,fit:"contain",class:fe("image",{vertical:h.value}),style:s.value,onLoad:te},o)]})}}});const[vt,q]=Q("image-preview"),dt=["show","teleport","transition","overlayStyle","closeOnPopstate"],ft={show:Boolean,loop:E,images:qe(),minZoom:j(1/3),maxZoom:j(3),overlay:E,closeable:Boolean,showIndex:E,className:ye,closeIcon:se("clear"),transition:String,beforeClose:Function,doubleScale:E,overlayClass:ye,overlayStyle:Object,swipeDuration:j(300),startPosition:j(0),showIndicators:Boolean,closeOnPopstate:E,closeOnClickOverlay:E,closeIconPosition:se("top-right"),teleport:[String,Object]};var mt=J({name:vt,props:ft,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:d,slots:f}){const t=A(),n=re({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),a=()=>{if(t.value){const u=Oe(t.value.$el);n.rootWidth=u.width,n.rootHeight=u.height,t.value.resize()}},P=u=>d("scale",u),h=u=>d("update:show",u),y=()=>{Ke(e.beforeClose,{args:[n.active],done:()=>h(!1)})},m=u=>{u!==n.active&&(n.active=u,d("change",u))},s=()=>{if(e.showIndex)return w("div",{class:q("index")},[f.index?f.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},r=()=>{if(f.cover)return w("div",{class:q("cover")},[f.cover()])},g=()=>{n.disableZoom=!0},x=()=>{n.disableZoom=!1},$=()=>w(et,{ref:t,lazyRender:!0,loop:e.loop,class:q("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:m,onDragEnd:x,onDragStart:g},{default:()=>[e.images.map((u,X)=>w(ut,{src:u,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:P,onClose:y,onLongPress:()=>d("longPress",{index:X})},{image:f.image}))]}),L=()=>{if(e.closeable)return w($e,{role:"button",name:e.closeIcon,class:[q("close-icon",e.closeIconPosition),Ge],onClick:y},null)},l=()=>d("closed"),T=(u,X)=>{var D;return(D=t.value)==null?void 0:D.swipeTo(u,X)};return me({swipeTo:T}),ue(a),R([xe,Ce],a),R(()=>e.startPosition,u=>m(+u)),R(()=>e.show,u=>{const{images:X,startPosition:D}=e;u?(m(+D),K(()=>{a(),T(+D,{immediate:!0})})):d("close",{index:n.active,url:X[n.active]})}),()=>w(Re,ce({class:[q(),e.className],overlayClass:[q("overlay"),e.overlayClass],onClosed:l,"onUpdate:show":h},Ve(e,dt)),{default:()=>[L(),$(),s(),r()]})}});let le;const gt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ht(){({instance:le}=Xe({setup(){const{state:e,toggle:d}=De(),f=()=>{e.images=[]};return()=>w(mt,ce(e,{onClosed:f,"onUpdate:show":d}),null)}}))}const St=(e,d=0)=>{if(ze)return le||ht(),e=Array.isArray(e)?{images:e,startPosition:d}:e,le.open(Qe({},gt,e)),le};export{ct as I,et as S,it as a,St as s};
